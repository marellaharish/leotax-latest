(()=>{"use strict";const e=require("express"),n=require("mongodb"),t=require("multer"),o=require("sanitize-html"),a=(require("react"),require("react-dom/server")),i=e();let s;t(),i.set("view engine","ejs"),i.set("views","./views"),i.use(e.static("public")),i.use(e.json()),i.use(e.urlencoded({extended:!1})),i.get("/",((e,n)=>{n.render("login")})),i.get("/login",((e,n)=>{n.render("login")})),i.use((function(e,n,t){n.set("WWW-Authenticate","Basic realm='Gym App'"),"Basic YWRtaW46YWRtaW4="==e.headers.authorization?t():(console.log(e.headers.authorization),n.status(401).send("Try Again"))})),i.get("/home",(async(e,n)=>{await s.collection("navlinks").find().toArray();const t=a.renderToString("<div>Welcome</div>");n.render("home",{linksCode:t})})),i.post("/api/createMem",(function(e,n,t){e.cleanData={name:o(e.body.name.trim(),{allowedTags:[],allowedAttributes:{}})},t()}),(async(e,t)=>{const o=await s.collection("navlinks").insertOne(e.cleanData),a=await s.collection("navlinks").findOne({_id:new n.ObjectId(o.insertedId)});t.send(a)})),i.delete("/api/delMem/:id",(async(e,t)=>{"string"!=typeof e.params.id&&(e.params.id=""),s.collection("navlinks").deleteOne({_id:new n.ObjectId(e.params.id)}),t.send("Done!")})),i.get("/bdetails",((e,n)=>{n.render("businessdetails")})),i.get("/api/members",(async(e,n)=>{const t=await s.collection("navlinks").find().toArray();n.json(t)})),i.get("/api/plans",(async(e,n)=>{const t=await s.collection("navlinks").find().toArray();n.json(t)})),i.get("/api/staff",(async(e,n)=>{const t=await s.collection("navlinks").find().toArray();n.json(t)})),i.get("/api/transactions",(async(e,n)=>{const t=await s.collection("navlinks").find().toArray();n.json(t)})),async function(){const e=new n.MongoClient("mongodb://localhost:27017/gymdb");console.log("connecting to mongo..."),await e.connect(),console.log("conneced"),s=e.db(),console.log("got db"),i.listen(9090),console.log("server started..")}()})();